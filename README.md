[![Build Status](https://secure.travis-ci.org/donquixote/krautoload.png)](https://travis-ci.org/donquixote/krautoload)

Krautoload is a pluggable PHP class autoloader library that makes you fantasize of Kartoffelbrei, Kasseler and Sauerkraut.

### Flexibility

It has native support for
- Class maps.
- The [proposed PSR-X](https://github.com/php-fig/fig-standards/blob/master/proposed/autoloader.md), which is a shallow-dir variation of PSR-0 without the special underscore handling.
- [PSR-0](https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md)
- PEAR (that is the old-school pattern with underscores instead of namespaces)
  (yes, this is just a subset of PSR-0, but Krautoload has explicit support for it)
- Variations of PSR-0 with different levels of "safety" (to avoid duplicate file inclusion, etc)

It also supports some "non-standard" stuff, *just because we can*, and it was too tempting not to do it:
- Variation of PSR-0 which allows shallow directory structures.
- Variation of PEAR which allows shallow directory structures.

Besides that, custom plugins can be mapped to any namespaces and prefixes, to allow the most wonky logical mappings.  
E.g. there is an example plugin "CamelSwap", that would map a class ".._TinyPetShop" to "../shop/pet/tiny.php".
(the idea is to support old-school libraries which still have *some logic* in where they put their classes)


### Compatibility

Krautoload has some useful methods to easily be used in projects built with Composer.
E.g.
```php
// Bootstrap the loader, and register it on the SPL autoload stack.
$krautoload = Krautoload::start();
// Read the namespaces.php and classes.php from the composer vendor directory,
// and register this stuff in the class loader.
$krautoload->composerVendorDir('vendor');
```


### Performance

The basic Krautoload "pluggable" class loader is designed to have a decent performance, that does no have to be afraid of competition.
Especially, the main lookup algorithm is designed to perform equally well no matter how many namespaces are registered.
(even if most of these namespaces all share the same prefix)

If that is not enough, there are different cache decorators, mostly equivalent with those you find in Symfony2:
- APC cache
- XCache
- WinCache

Alternatively, you could generate a huge classmap (with any suitable tool) and register that in the Krautoload loader.


## Project status and history

The project has changed a lot in recent days and weeks, but it is now probably quite close to a stable shape.  
Still, some API details may still change based on community feedback.  
Especially, the term "PSR-X" may change in the future, if it gets accepted.

The project is a spin-off of the ["xautoload" module for Drupal](http://drupal.org/project/xautoload), with some changes.  

Unlike xautoload, Krautoload is written in anticipation of the hopefully upcoming PSR-X.  
It is optimized for PSR-X, and needs a tiny-tiny extra operation if wired up with PSR-0, for the special underscore handling.


## Purpose / Audience

Modern PHP projects typically use class loading solutions shipped with the framework, or provided by Composer.
Thus, Krautoload is mainly aimed at framework developers, for full inclusion, copying, or inspiration.


## Usage

Krautoload provides a start-off class with static methods, for those who want to avoid a lengthy bootstrap.  
Alternative bootstrap helpers may be provided based on community feedback.

```php
require_once "$path_to_krautoload/src/Krautoload.php";

// Create the class loader and register it.
$krautoload = Krautoload::start();

// Register additional namespaces
$krautoload->namespacePSR0('FooVendor\FooPackage', "$path_to_foo_package/src");

new FooVendor\FooPackage\Foo\Bar\Baz();
```

See [Krautoload\RegistrationHub](https://github.com/donquixote/krautoload/blob/master/src/Krautoload/RegistrationHub.php)
to see all the available registration methods.


### Usage with Composer

Krautoload can be used instead of the autoload.php generated by Composer.  
Boot Krautoload like above, and then

```php
// Let Krautoload look for the files defining the namespace map and class map.
$krautoload->composerVendorDir($vendor_dir);
```


## Unit tests

Krautoload is designed to be unit-testable, better than other class loaders.  
Its architecture allows to mock out and simulate all hits to the filesystem (file_exists(), require_once, etc).

Unfortunately, I have no experience with testing frameworks outside of Drupal (yet).  
Thus, no tests exist yet.  
(but there are tests in Drupal xautoload, which show that the architecture is ok)


## Benchmarks

Benchmarks would be nice to have, but they do not exist yet. Any help
appreciated.

Like Tests, benchmarks *can* be programmed with a mocked-out filesystem, where
instead of actually doing file inclusion or file_exists(), we simply count the
number of times this would happen.

This will not tell us the real duration in a live environment, but it will
determine the time used for the actual class finding much more accurately than
with the natural variations of filesystem operations.
